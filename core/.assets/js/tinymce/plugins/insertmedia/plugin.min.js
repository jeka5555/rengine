tinymce.PluginManager.add('insertmedia', function(editor, url) {
    // Add a button that opens a window
    editor.addButton('insertmedia', {
        icon: 'insertmedia',
        onclick: function() {
            var insertMediaWindow = new Apps.MediaInsert();
            insertMediaWindow.addListener('insertMedia', function(e) {
                editor.insertContent(e.data.content);
            });
        }
    });
});